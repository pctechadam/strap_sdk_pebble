function strap_api_init_accel(t,a){t.config({rate:10,samples:10});var e=strap_api_clone(a);e.action_url="STRAP_API_ACCL",strap_api_accl_on(t,e)}function strap_api_accl_on(t,a){console.log("turning accl on"),strap_api_log(a),t.on("data",function(t){var a=(new Date).getTime(),e=0;t.accels.length>0&&(e=t.accels[0].time);for(var n=0;n<t.accels.length;n++)t.accels[n].time=a+t.accels[n].time-e;var o=window.localStorage.strap_accl;o=o?JSON.parse(o):[],o=o.concat(t.accels),window.localStorage.strap_accl=JSON.stringify(o)}),setTimeout(function(){strap_api_log(a),strap_api_accl_off(t,a)},6e4)}function strap_api_accl_off(t,a){console.log("turning accl off"),strap_api_log(a),t.off(),setTimeout(function(){strap_api_log(a),strap_api_accl_on(t,a)},12e4)}function strap_api_init(t){var a=strap_api_clone(t);a.action_url="STRAP_START",strap_api_log(a)}function strap_api_conv_accel(t,a){for(var e=[],n=0;n<t.length;n++){var o={};o.x=t[n].x,o.y=t[n].y,o.z=t[n].z,o.ts=t[n].time,o.vib=t[n].vibe?!0:!1,o.act=a,e.push(o)}return e}function strap_api_log(t){var a=t,e=new XMLHttpRequest;e.open("POST",strap_api_url,!0);var n=(new Date).getTimezoneOffset()/60*-1,o="app_id="+a.app_id+"&resolution="+(a.resolution||"")+"&useragent="+(a.useragent||"")+"&action_url="+(a.action_url||"")+"&visitor_id="+(a.visitor_id||Pebble.getAccountToken())+"&act="+(a.act||"")+"&visitor_timeoffset="+n;if("STRAP_API_ACCL"===a.action_url){var i=window.localStorage.strap_accl;if(i=i?JSON.parse(i):[],i.length<100)return;var c=strap_api_conv_accel(i);o=o+"&accl="+encodeURIComponent(JSON.stringify(c)),window.localStorage.removeItem("strap_accl")}else{var r=strap_api_clone(t);r.action_url="STRAP_API_ACCL",setTimeout(function(){strap_api_log(r)},100)}e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.setRequestHeader("Content-length",o.length),e.setRequestHeader("Connection","close"),e.onload=function(){4==e.readyState&&200==e.status&&200==e.status},e.send(o)}var strap_api_url="https://api.straphq.com/create/visit/with/",strap_api_clone=function(t){var a,e={};if(!t||"object"!=typeof t)return t;for(a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e},APP={};module.exports={Init:function(t){APP=strap_api_clone(t),APP&&strap_api_init(APP)},InitAccel:function(t,a){APP=strap_api_clone(t),APP&&a&&strap_api_init_accel(a,APP)},Log:function(t){var a=strap_api_clone(APP);a.action_url=t,strap_api_log(a)}};